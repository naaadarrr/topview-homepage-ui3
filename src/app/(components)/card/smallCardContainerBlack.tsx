import { type NotionData } from "@/app/layouts/responsiveNavBar";
import { getPage } from "@/utils/notion/notion";
import {
  Box,
  Card,
  Center,
  HStack,
  Heading,
  Stack,
  Text,
} from "@chakra-ui/react";
import { type ReactNode } from "react";

export type HeadingInfo = {
  heading: string;
  description: string;
};

export type CardInfo = {
  id: number;
  title: string;
  text: string;
  svg?: ReactNode;
};

const cardListSvg = [
  {
    id: 0,
    svg: <CardListSvg />,
  },
  {
    id: 1,
    svg: <CardListSvgTwo />,
  },
  {
    id: 2,
    svg: <CardListSvgThree />,
  },
];

export default async function SmallCardContainerBlack() {
  const page = (await getPage({
    name: "smallCardContainerBlack",
  })) as NotionData;
  const headingCount = page.titleList.length - page.textList.length;

  const [headingInfo, cardListInfo] = translateCardData(page, headingCount, 0);
  return (
    <Box mt={{ base: "3.125rem", xl: "134px" }} display="none">
      <Heading
        textAlign="center"
        fontWeight="600"
        lineHeight={{ base: "5rem", xl: "50px" }}
        fontSize={{ base: "2.25rem", xl: "50px" }}
      >
        {headingInfo.heading}
      </Heading>
      <HStack
        w="100%"
        gap={{ base: "1.125rem", xl: "31px" }}
        mt={{ base: undefined, xl: "51px" }}
        flexDirection={{ base: "column", xl: "row" }}
        justifyContent="center"
      >
        {cardListInfo.map((card) => {
          return (
            <article key={card.id}>
              <Card
                w="370px"
                h="330px"
                borderRadius="30px"
                bg="linear-gradient(251deg, #1C1C1C 10.02%, #121111 92.51%)"
                justifyContent="center"
                alignItems="center"
                color="#fff"
              >
                <Stack>
                  <Center>
                    <Box
                      w="75px"
                      h="75px"
                      border="4px solid #1A1A1A"
                      borderRadius="26px"
                      bg="linear-gradient(116deg, #8231BB 0.97%, #2C74FF 84.83%)"
                      display="flex"
                      justifyContent="center"
                      alignItems="center"
                    >
                      {card.svg}
                    </Box>
                  </Center>
                  <Center>
                    <Heading fontFamily="Eina03-Bold" fontSize="28px">
                      {card.title}
                    </Heading>
                  </Center>
                  <Center>
                    <Text
                      w="272px"
                      fontSize="18px"
                      fontWeight="400"
                      lineHeight="21.78px"
                      textAlign="center"
                    >
                      {card.text}
                    </Text>
                  </Center>
                </Stack>
              </Card>
            </article>
          );
        })}
      </HStack>
    </Box>
  );
}

export function translateCardData(
  page: NotionData,
  headingCount: number,
  subHeadingCount: number,
): [HeadingInfo, CardInfo[]] {
  const headingInfo = {
    // 如果有heading，则展示，否则不
    heading: headingCount ? page.titleList[0]! : "",
    description: subHeadingCount ? page.textList[0]! : "",
  };
  const cardListInfo = [];
  // 如果titleList - textList，数量多出来的就是heading；重叠的就是Card组件的数量
  for (let i = 0; i < page.textList.length; i++) {
    cardListInfo.push({
      id: i,
      title: page.titleList[i + headingCount]!,
      text: page.textList[i]!,
      svg: cardListSvg[i]?.svg,
    });
  }
  return [headingInfo, cardListInfo];
}

// 下面都是Card组件需要的svg
function CardListSvg() {
  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="47"
      height="47"
      viewBox="0 0 47 47"
      fill="none"
    >
      <path
        d="M44.5637 38.6703L34.2825 18.1079C34.0994 17.7422 33.8181 17.4347 33.4702 17.2198C33.1223 17.005 32.7214 16.8911 32.3125 16.8911C31.9036 16.8911 31.5027 17.005 31.1548 17.2198C30.8069 17.4347 30.5256 17.7422 30.3425 18.1079L26.5752 25.6352C24.0371 25.4133 21.5932 24.5676 19.4609 23.1732C22.0521 20.1599 23.673 16.4343 24.1114 12.4844H27.9063C28.4906 12.4844 29.0509 12.2523 29.4641 11.8391C29.8773 11.4259 30.1094 10.8656 30.1094 10.2812C30.1094 9.69694 29.8773 9.13657 29.4641 8.7234C29.0509 8.31024 28.4906 8.07812 27.9063 8.07812H18.3594V5.875C18.3594 5.29069 18.1273 4.73032 17.7141 4.31716C17.3009 3.90399 16.7406 3.67188 16.1563 3.67188C15.5719 3.67188 15.0116 3.90399 14.5984 4.31716C14.1852 4.73032 13.9531 5.29069 13.9531 5.875V8.07812H4.40625C3.82195 8.07812 3.26157 8.31024 2.84841 8.7234C2.43524 9.13657 2.20313 9.69694 2.20312 10.2812C2.20313 10.8656 2.43524 11.4259 2.84841 11.8391C3.26157 12.2523 3.82195 12.4844 4.40625 12.4844H19.6684C19.2551 15.3557 18.0375 18.0513 16.1563 20.2596C15.2382 19.1853 14.4722 17.9899 13.8797 16.707C13.7636 16.4372 13.5948 16.1933 13.3831 15.9897C13.1714 15.7861 12.9212 15.6269 12.6471 15.5214C12.3729 15.4159 12.0805 15.3663 11.7869 15.3755C11.4934 15.3846 11.2046 15.4524 10.9376 15.5749C10.6706 15.6973 10.4308 15.8718 10.2323 16.0883C10.0337 16.3047 9.88046 16.5587 9.7815 16.8352C9.68255 17.1118 9.63989 17.4053 9.65603 17.6986C9.67217 17.9919 9.7468 18.279 9.87551 18.543C10.6462 20.219 11.6479 21.7788 12.8516 23.1769C10.3443 24.8272 7.40791 25.7056 4.40625 25.7031C3.82195 25.7031 3.26157 25.9352 2.84841 26.3484C2.43524 26.7616 2.20313 27.3219 2.20312 27.9062C2.20313 28.4906 2.43524 29.0509 2.84841 29.4641C3.26157 29.8773 3.82195 30.1094 4.40625 30.1094C8.63632 30.1128 12.7555 28.7567 16.1563 26.2411C18.6225 28.056 21.4742 29.2774 24.4896 29.8101L20.0595 38.6703C19.9218 38.9299 19.8374 39.2143 19.8112 39.507C19.7851 39.7996 19.8178 40.0945 19.9073 40.3743C19.9968 40.6541 20.1414 40.9132 20.3326 41.1363C20.5237 41.3594 20.7576 41.542 21.0204 41.6734C21.2831 41.8048 21.5695 41.8823 21.8627 41.9014C22.1559 41.9204 22.4499 41.8807 22.7275 41.7844C23.0051 41.6881 23.2606 41.5373 23.479 41.3408C23.6974 41.1444 23.8744 40.9062 23.9994 40.6403L26.3292 35.9844H38.294L40.622 40.6403C40.7513 40.8991 40.9304 41.1299 41.1489 41.3196C41.3675 41.5092 41.6212 41.6539 41.8957 41.7454C42.1702 41.837 42.46 41.8736 42.7486 41.8531C43.0372 41.8327 43.319 41.7556 43.5778 41.6262C43.8366 41.4969 44.0674 41.3178 44.2571 41.0993C44.4467 40.8807 44.5914 40.6269 44.6829 40.3525C44.7745 40.078 44.8111 39.7882 44.7906 39.4995C44.7702 39.2109 44.6931 38.9292 44.5637 38.6703ZM28.5323 31.5781L32.3125 24.0196L36.0909 31.5781H28.5323Z"
        fill="white"
      />
    </svg>
  );
}

function CardListSvgTwo() {
  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="50"
      height="50"
      viewBox="0 0 50 50"
      fill="none"
    >
      <path
        d="M21.3516 27.0837C21.3516 27.4256 21.2842 27.7643 21.1533 28.0802C21.0225 28.3962 20.8306 28.6833 20.5888 28.9251C20.347 29.1669 20.0599 29.3587 19.744 29.4896C19.428 29.6205 19.0894 29.6878 18.7474 29.6878C18.0567 29.6878 17.3943 29.4135 16.906 28.9251C16.4176 28.4367 16.1432 27.7743 16.1432 27.0837C16.1432 26.393 16.4176 25.7306 16.906 25.2422C17.3943 24.7539 18.0567 24.4795 18.7474 24.4795C19.0894 24.4795 19.428 24.5469 19.744 24.6777C20.0599 24.8086 20.347 25.0004 20.5888 25.2422C20.8306 25.4841 21.0225 25.7711 21.1533 26.0871C21.2842 26.403 21.3516 26.7417 21.3516 27.0837ZM31.2474 24.4795C30.5567 24.4795 29.8943 24.7539 29.406 25.2422C28.9176 25.7306 28.6432 26.393 28.6432 27.0837C28.6432 27.7743 28.9176 28.4367 29.406 28.9251C29.8943 29.4135 30.5567 29.6878 31.2474 29.6878C31.9381 29.6878 32.6004 29.4135 33.0888 28.9251C33.5772 28.4367 33.8516 27.7743 33.8516 27.0837C33.8516 26.393 33.5772 25.7306 33.0888 25.2422C32.6004 24.7539 31.9381 24.4795 31.2474 24.4795ZM45.8307 25.0003C45.8307 30.5257 43.6358 35.8247 39.7288 39.7317C35.8218 43.6387 30.5227 45.8337 24.9974 45.8337C22.2615 45.8337 19.5524 45.2948 17.0248 44.2478C14.4972 43.2008 12.2006 41.6663 10.266 39.7317C6.359 35.8247 4.16406 30.5257 4.16406 25.0003C4.16406 19.475 6.359 14.1759 10.266 10.2689C14.173 6.36193 19.4721 4.16699 24.9974 4.16699C27.7333 4.16699 30.4424 4.70586 32.97 5.75284C35.4976 6.79981 37.7942 8.33438 39.7288 10.2689C41.6633 12.2035 43.1979 14.5001 44.2449 17.0278C45.2919 19.5554 45.8307 22.2645 45.8307 25.0003ZM22.2057 8.58366C25.1224 13.417 30.4141 16.667 36.4557 16.667C37.4141 16.667 38.3516 16.5628 39.2474 16.417C36.3307 11.5837 31.0391 8.33366 24.9974 8.33366C24.0391 8.33366 23.1016 8.43783 22.2057 8.58366ZM9.20573 19.7295C12.8007 17.6915 15.5162 14.3973 16.8307 10.4795C13.2357 12.5175 10.5203 15.8117 9.20573 19.7295ZM41.6641 25.0003C41.6641 23.3753 41.4141 21.8128 40.9766 20.3337C39.5182 20.6462 38.0182 20.8337 36.4557 20.8337C33.3591 20.8343 30.3012 20.1447 27.5046 18.8148C24.708 17.485 22.2431 15.5485 20.2891 13.1462C19.1951 15.7904 17.5691 18.1814 15.5118 20.1705C13.4546 22.1596 11.0103 23.7043 8.33073 24.7087V25.0003C8.33073 34.1878 15.8099 41.667 24.9974 41.667C34.1849 41.667 41.6641 34.1878 41.6641 25.0003Z"
        fill="white"
      />
    </svg>
  );
}

function CardListSvgThree() {
  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="47"
      height="47"
      viewBox="0 0 47 47"
      fill="none"
    >
      <path
        d="M15.6667 27.4167V33.2917M23.5 27.4167V33.2917M31.3333 27.4167V33.2917M5.875 41.125H41.125M5.875 19.5833H41.125M5.875 13.7083L23.5 5.875L41.125 13.7083M7.83333 19.5833H39.1667V41.125H7.83333V19.5833Z"
        stroke="white"
        strokeWidth="3.91667"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
    </svg>
  );
}
